/*! bootstrap-ssdlg 2015-07-13 */
"use strict";!function(a){"function"==typeof define&&define.amd?define(["jquery","jquery-imagerect","bootstrap-colorpicker-plus","bootstrap-slider"],a):window.jQuery&&!window.jQuery.fn.shapeStyleDialog&&a(window.jQuery)}(function(a){var b=["Arial","Verdana","Helvetica","Courier","Times","Roboto","Oswald","Open Sans Condensed","Roboto Slab","Droid Serif","Roboto Condensed","Raleway","Bangers","Permanent Marker","Droid Sans Mono"],c=[9,10,11,12,13,14,16,18,20,24,36,48,64,72,96,110,127],d={strokeSize:1},e=function(e,f){var g=this;this.element=a(e),this.opts=a.extend({},d,this.element.data(),f),this.colorpickerembeds=a(".colorpickerembed.colorpickerplus-container",this.element),this.colorpickerembeds.colorpickerembed(),this.colorpickerembeds.on("changeColor",a.proxy(this.onOptChanged,this)),this.colorpickerpluss=a("button[data-toggle=colorpickerplus]",this.element),this.colorpickerpluss.colorpickerplus(),this.colorpickerpluss.on("changeColor",a.proxy(this.onOptChanged,this)),this.sliders=a("input[data-toggle=slider]",this.element).slider(),this.sliders.on("slideStop",a.proxy(this.onOptChanged,this)),a("ul[aria-labelledby]",this.element).each(function(){var d=a(this).attr("aria-labelledby");switch(d){case"fontFamilyDropdownMenu":for(var e=0;e<b.length;e++)a('<li data-ssdlg-key="font-family" data-ssdlg-val="'+b[e]+'"><a href="#">'+b[e]+"</a></li>").appendTo(a(this));break;case"fontSizeDropdownMenu":for(e=0;e<c.length;e++)a('<li data-ssdlg-key="font-size" data-ssdlg-val="'+c[e]+'"><a href="#">'+c[e]+"px</a></li>").appendTo(a(this))}}),this.element.on("click","button[data-toggle=dropdown]",function(){var b=a(this),c=b.attr("id"),d=a("ul[aria-labelledby="+c+"]",a(e)),f=a("li",d);f.each(function(){var b=a(this).data("ssdlg-key"),c=a(this).data("ssdlg-val");return null!==b&&c===g.option[b]?!1:void 0})}),this.element.on("click","li[data-ssdlg-key],button[data-ssdlg-val],a[data-ssdlg-key]",function(){var b=a(this).data("ssdlg-key");if(null!=b){var c=a(this).data("ssdlg-val");switch(b){case"font-style":c="italic"===c?"normal":"italic",a(this).data("ssdlg-val",c);break;case"font-weight":c="bolder"===c?"normal":"bolder",a(this).data("ssdlg-val",c);break;case"font-decoration":c="underline"===c?"line-through":"line-through"===c?"overline":"overline"===c?"":"underline",a(this).data("ssdlg-val",c);break;default:0===b.indexOf("font-align-")&&(c=g.handleFontAlign(a(this),b.substring(11)),b="font-align")}g.changeOpt(b,c,a(this))}}),a("input[data-ssdlg-key]",this.element).on("blur",a.proxy(this.inputBlur,this));var h=a("#tab_image"),i=a(".imagerect",h).imagerect();i.on("load",a.proxy(this.imgload,this)),i.on("pick",a.proxy(this.imagepick,this)),this.imgpicker=i,a("input",h).on("blur",a.proxy(this.imagePickerBlur,this)),a('a[data-toggle="tab"]',this.element).on("show.bs.tab",function(b){a(".nav-tabs > li.active",this.element).removeClass("active");var c=a(b.target).attr("href");a('a[href="'+c+'"]',a(".nav-tabs",this.element)).parent().addClass("active")}),a('a[data-toggle="tab"]',this.element).on("shown.bs.tab",a.proxy(this.tabShown,this)),a(".slider",this.element).on("click touchstart",a.proxy(this.stopPropagation,this)),a("#ssdlg-link-btn").on("click",function(){a("#ssdlg-link-panel").toggle()}),a("#ssdlg-link-panel").toggle()};e.version="0.1.0",e.prototype={constructor:e,setDlgItemStyle:function(b,c,d,e){switch(b){case"fillStyle":var f=a(".shapestyle-dlg-background-icon",d.closest(".dropdown-colorpickerplus"));if(null!=c?(f.removeClass("colorpicker-color"),f.css("background-color",c)):(f.removeAttr("style"),f.addClass("colorpicker-color")),e){var g=this.colorpickerembeds.index('[data-ssdlg-key="fillStyle"]');this.colorpickerembeds.eq(g).colorpickerembed("update",c)}break;case"strokeStyle":var h=a(".shapestyle-dlg-line",this.element);null!=c?(h.removeClass("colorpicker-color"),h.css("background-color",c)):h.addClass("colorpicker-color"),e&&this.colorpickerembeds.eq(this.colorpickerembeds.index('[data-ssdlg-key="strokeStyle"]')).colorpickerembed("update",c);break;case"x":case"y":case"w":case"h":case"r":a('input[data-ssdlg-key="'+b+'"]',this.element).val(c);break;case"alpha":this.sliders.slider("setValue",c);break;default:if(0===b.indexOf("font-")){var i=a('button[data-ssdlg-key="'+b+'"]');i.data("ssdlg-val",c)}}},changeOpt:function(a,b,c){this.opt(a,b,c),this.element.trigger({type:"optionChange",key:a,val:b})},onOptChanged:function(b){var c=a(b.target).data("ssdlg-key"),d=b.color||b.value,e=a(b.target);this.opts[c]=d,this.setDlgItemStyle(c,d,e,!1),this.element.trigger({type:"optionChange",key:c,val:d})},opt:function(a,b,c){this.opts[a]=b,this.setDlgItemStyle(a,b,c,!0)},setCPPColor:function(b,c){var d=a('button[data-toggle=colorpickerplus][data-ssdlg-key="'+b+'"]',this.element);d.data("cpp-color",c),this.opt(b,c,d)},option:function(b){if(b){this.opts=a.extend({},d,this.element.data(),b);for(var c in b)switch(c){case"strokeStyle":this.setCPPColor(c,b[c]);break;case"fillStyle":this.opt(c,b[c],a('div[data-ssdlg-key="'+c+'"]',this.element));break;default:this.opt(c,b[c])}}return this.opts},handleFontAlign:function(a,b){var c="font-align",d=a.data("ssdlg-val");return a.data("ssdlg-val",d===b?0:b),d=d===b?this.opts[c]|b:this.opts[c]&~b},imgload:function(a){this.element.trigger({type:"imgload",relatedTarget:a.relatedTarget});var b=this.imgpicker.imagerect("rect");this.onImgRect(b)},imagepick:function(a){var b=a.value;this.onImgRect(b)},imgInput:function(){var a=this.imgPickerUrl.val();a?this.imgpicker.imagerect("option",{url:a}):this.imgPickerUrl.tooltip("show")},onImgRect:function(b){for(var c in b){var d="#formRectP"+c.toUpperCase();a(d).val(Math.round(b[c]*this.imgpicker.data("imagerect").percent*100)/100)}var e=this.imgpicker.imagerect("option");b.url=e.url,this.changeOpt("img",b)},imagePickerBlur:function(b){var c=a(b.target),d=c.val(),e=c.attr("id"),f=null;switch(a.isNumeric(d)&&(d/=this.imgpicker.data("imagerect").percent),e){case"formRectPX":f={x:d};break;case"formRectPY":f={y:d};break;case"formRectPW":f={w:d};break;case"formRectPH":f={h:d};break;case"imgPickerUrl":d?this.imgpicker.imagerect("option",{url:d}):c.tooltip("show")}if(f){f=this.imgpicker.imagerect("rect",f);var g=this.imgpicker.imagerect("option");this.changeOpt("img",a.extend({url:g.url},f))}},inputBlur:function(b){var c=a(b.target),d=c.val(),e=c.data("ssdlg-key");this.changeOpt(e,d)},stopPropagation:function(a){a.stopPropagation()},tabShown:function(b){var c=a(b.target).attr("href");"#tab_image"===c&&this.opts.img&&this.imgpickerUpdate()},imgpickerUpdate:function(){this.imgpicker.imagerect("rect",this.opts.img)}},a.shapeStyleDialog=e,a.fn.shapeStyleDialog=function(b){var c=arguments,d=null;return this.each(function(){var f=a(this),g=f.data("shapeStyleDialog"),h="object"==typeof b?b:{};g||"string"==typeof b?"string"==typeof b&&(d=g[b].apply(g,Array.prototype.slice.call(c,1))):f.data("shapeStyleDialog",new e(this,h))}),d||this},a.fn.shapeStyleDialog.constructor=e});